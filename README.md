# GoodSticks - è®°äº‹æœ¬åº”ç”¨

ä¸€ä¸ªç®€æ´ä¼˜é›…çš„Androidè®°äº‹æœ¬åº”ç”¨ï¼Œé‡‡ç”¨Material Design 3è®¾è®¡è§„èŒƒï¼Œç•Œé¢ç±»ä¼¼iOSé£æ ¼ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ” **ç™»å½•åŠŸèƒ½**ï¼šæ”¯æŒè®°ä½å¯†ç 
- ğŸ“ **ç¬”è®°ç®¡ç†**ï¼šåˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤ç¬”è®°
- ğŸ“¸ **å›¾ç‰‡æ”¯æŒ**ï¼šæ‹ç…§æˆ–ä»ç›¸å†Œé€‰æ‹©å›¾ç‰‡
- ğŸ¨ **ä¸»é¢˜åˆ‡æ¢**ï¼š7ç§ä¸»é¢˜è‰²å¯é€‰
- ğŸ“Œ **ç½®é¡¶åŠŸèƒ½**ï¼šé‡è¦ç¬”è®°ç½®é¡¶æ˜¾ç¤º
- ğŸ” **æœç´¢åŠŸèƒ½**ï¼šå¿«é€ŸæŸ¥æ‰¾ç¬”è®°
- ğŸ’¾ **æ•°æ®å¤‡ä»½**ï¼šæ”¯æŒWebDAVå¤‡ä»½ä¸æ¢å¤

## æŠ€æœ¯æ ˆ

- **è¯­è¨€**ï¼šJava
- **æœ€ä½SDK**ï¼š24 (Android 7.0)
- **ç›®æ ‡SDK**ï¼š35 (Android 15)
- **æ¶æ„**ï¼šMVVM
- **UIè®¾è®¡**ï¼šMaterial Design 3
- **æ•°æ®åº“**ï¼šRoom
- **å›¾ç‰‡åŠ è½½**ï¼šGlide 4.16.0
- **å®‰å…¨å­˜å‚¨**ï¼šEncryptedSharedPreferences
- **åŠ¨ç”»æ•ˆæœ**ï¼šLottie 6.2.0
- **æ•°æ®åŒæ­¥**ï¼šWebDAV (sardine-android)

## é¡¹ç›®ç»“æ„

```
app/src/main/java/cn/younglee/goodsticks/
â”œâ”€â”€ data                    # æ•°æ®å±‚
â”‚   â”œâ”€â”€ converter           # ç±»å‹è½¬æ¢å™¨
â”‚   â”œâ”€â”€ dao                 # æ•°æ®è®¿é—®å¯¹è±¡
â”‚   â”œâ”€â”€ database            # æ•°æ®åº“å®šä¹‰
â”‚   â”œâ”€â”€ entity              # æ•°æ®å®ä½“ç±»
â”‚   â””â”€â”€ repository          # æ•°æ®ä»“åº“
â”œâ”€â”€ ui                      # ç”¨æˆ·ç•Œé¢
â”‚   â”œâ”€â”€ auth                # ç™»å½•/æ³¨å†Œ
â”‚   â”œâ”€â”€ home                # ä¸»é¡µ
â”‚   â”œâ”€â”€ note                # ç¬”è®°ç¼–è¾‘
â”‚   â”œâ”€â”€ settings            # è®¾ç½®
â”‚   â””â”€â”€ splash              # å¯åŠ¨é¡µ
â””â”€â”€ utils                   # å·¥å…·ç±»
```

## ä¸»é¢˜è‰²

- æºå¿ƒè“ï¼š#1140b6
- æ«å¶çº¢ï¼š#ab3b2d
- æ´»åŠ›ç²‰ï¼š#fe578d
- é—ªç”µç´«ï¼š#bd90e8
- ä¾¿å•é»„ï¼š#eca113
- å®çŸ³ç»¿ï¼š#0dae68
- è‰æœ¨é’ï¼š#33bfb6

## ä½¿ç”¨è¯´æ˜

1. **é¦–æ¬¡ä½¿ç”¨**
   - å¯åŠ¨åº”ç”¨åä¼šè¿›å…¥ç™»å½•é¡µé¢
   - ç‚¹å‡»"è¿˜æ²¡æœ‰è´¦å·ï¼Ÿç‚¹å‡»æ³¨å†Œ"åˆ›å»ºé»˜è®¤è´¦å·
   - é»˜è®¤ç”¨æˆ·åï¼šadminï¼Œå¯†ç ï¼š123456

2. **åˆ›å»ºç¬”è®°**
   - ç‚¹å‡»å³ä¸‹è§’çš„"æ–°å»ºç¬”è®°"æŒ‰é’®
   - è¾“å…¥æ ‡é¢˜å’Œå†…å®¹
   - å¯ç‚¹å‡»ç›¸æœºæŒ‰é’®æ·»åŠ å›¾ç‰‡

3. **ç®¡ç†ç¬”è®°**
   - é•¿æŒ‰ç¬”è®°å¯è¿›è¡Œç½®é¡¶æˆ–åˆ é™¤æ“ä½œ
   - ç‚¹å‡»ç¬”è®°è¿›å…¥ç¼–è¾‘æ¨¡å¼
   - æœç´¢æ¡†å¯å¿«é€ŸæŸ¥æ‰¾ç¬”è®°å†…å®¹

4. **ä¸ªæ€§åŒ–è®¾ç½®**
   - åœ¨è®¾ç½®é¡µé¢å¯åˆ‡æ¢æ·±è‰²æ¨¡å¼
   - å¯é€‰æ‹©7ç§ä¸åŒçš„ä¸»é¢˜è‰²
   - æ”¯æŒé€šè¿‡WebDAVå¤‡ä»½å’Œæ¢å¤æ•°æ®

## ç¼–è¯‘è¿è¡Œ

1. ä½¿ç”¨Android Studioæ‰“å¼€é¡¹ç›®
2. åŒæ­¥Gradleä¾èµ–
3. è¿æ¥Androidè®¾å¤‡æˆ–å¯åŠ¨æ¨¡æ‹Ÿå™¨
4. ç‚¹å‡»è¿è¡ŒæŒ‰é’®

## æŠ€æœ¯å®ç°

### 1. ç”¨æˆ·è®¤è¯ç³»ç»Ÿ

ç”¨æˆ·è®¤è¯ç³»ç»Ÿå®ç°äº†ç”¨æˆ·çš„æ³¨å†Œã€ç™»å½•å’Œæ³¨é”€åŠŸèƒ½ï¼Œé‡‡ç”¨å®‰å…¨çš„`EncryptedSharedPreferences`ä¿æŠ¤ç”¨æˆ·æ•°æ®ã€‚

```java
private void performLogin(String username, String password) {
    // æ˜¾ç¤ºè¿›åº¦æ¡
    binding.progressBar.setVisibility(View.VISIBLE);
    binding.btnLogin.setEnabled(false);
    
    userRepository.login(username, password).thenAccept(user -> {
        runOnUiThread(() -> {
            if (user != null) {
                // ç™»å½•æˆåŠŸï¼Œä¿å­˜ç”¨æˆ·ä¿¡æ¯
                SharedPreferences.Editor editor = prefs.edit();
                editor.putBoolean("is_logged_in", true);
                editor.putString("username", username);
                editor.putLong("user_id", user.getId());
                
                if (binding.cbRememberPassword.isChecked()) {
                    editor.putString("password", password);
                }
                editor.apply();
                
                // è·³è½¬åˆ°ä¸»é¡µ
                Intent intent = new Intent(this, MainActivity.class);
                startActivity(intent);
                finish();
            } else {
                // ç™»å½•å¤±è´¥
                Snackbar.make(binding.getRoot(), R.string.error_incorrect_password, Snackbar.LENGTH_LONG).show();
            }
        });
    });
}
```

### 2. ç¬”è®°ç®¡ç†ç³»ç»Ÿ

#### ç¬”è®°å®ä½“è®¾è®¡

```java
@Entity(tableName = "notes")
public class Note {
    @PrimaryKey(autoGenerate = true)
    private long id;
    
    @ColumnInfo(name = "title")
    private String title;
    
    @ColumnInfo(name = "content")
    private String content;
    
    @ColumnInfo(name = "created_date")
    private Date createdDate;
    
    @ColumnInfo(name = "modified_date")
    private Date modifiedDate;
    
    @ColumnInfo(name = "image_path")
    private String imagePath;
    
    @ColumnInfo(name = "is_pinned")
    private boolean isPinned;
    
    @ColumnInfo(name = "color")
    private int color;
    
    @ColumnInfo(name = "user_id")
    private long userId;
    
    // æ„é€ å‡½æ•°å’Œgetter/setterçœç•¥
}
```

#### ç€‘å¸ƒæµå¸ƒå±€å®ç°

```java
private void setupRecyclerView() {
    // ä½¿ç”¨ç€‘å¸ƒæµå¸ƒå±€ï¼Œç±»ä¼¼iOSçš„å¡ç‰‡å¼è®¾è®¡
    StaggeredGridLayoutManager layoutManager = new StaggeredGridLayoutManager(2, LinearLayoutManager.VERTICAL);
    binding.recyclerView.setLayoutManager(layoutManager);
    
    adapter = new NoteAdapter(new NoteAdapter.NoteClickListener() {
        @Override
        public void onNoteClick(long noteId) {
            // æ‰“å¼€ç¼–è¾‘é¡µé¢
            Intent intent = new Intent(getActivity(), EditNoteActivity.class);
            intent.putExtra(EditNoteActivity.EXTRA_NOTE_ID, noteId);
            startActivity(intent);
        }
        
        @Override
        public void onNoteLongClick(long noteId) {
            // é•¿æŒ‰æ˜¾ç¤ºé€‰é¡¹èœå•
            showNoteOptionsDialog(noteId);
        }
    });
    
    binding.recyclerView.setAdapter(adapter);
}
```

#### æœç´¢åŠŸèƒ½å®ç°

```java
private void setupSearch() {
    binding.etSearch.addTextChangedListener(new TextWatcher() {
        @Override
        public void afterTextChanged(Editable s) {
            String query = s.toString().trim();
            if (query.isEmpty()) {
                observeNotes();
            } else {
                noteViewModel.searchNotes(query).observe(getViewLifecycleOwner(), notes -> {
                    adapter.submitList(notes);
                    updateEmptyView(notes == null || notes.isEmpty());
                });
            }
        }
        // å…¶ä»–æ–¹æ³•çœç•¥
    });
}
```

### 3. WebDAVäº‘åŒæ­¥

åº”ç”¨é€šè¿‡WebDAVåè®®å®ç°äº†ç¬”è®°çš„äº‘å¤‡ä»½å’Œæ¢å¤åŠŸèƒ½ï¼š

```java
public static CompletableFuture<String> createBackup(Context context, long userId) {
    return CompletableFuture.supplyAsync(() -> {
        try {
            // åˆ›å»ºå¤‡ä»½æ•°æ®
            BackupData backupData = createBackupData(context, userId);
            String jsonData = gson.toJson(backupData);
            
            // å‡†å¤‡WebDAVå®¢æˆ·ç«¯å’Œæ–‡ä»¶å
            Sardine sardine = getSardine(context);
            
            // ä¸Šä¼ å¤‡ä»½æ–‡ä»¶
            // ä»£ç çœç•¥
            
            // æ›´æ–°æœ€åå¤‡ä»½æ—¶é—´
            String readableTime = new SimpleDateFormat("yyyy-MM-dd HH:mm", Locale.getDefault()).format(new Date());
            updateLastBackupTime(context, readableTime);
            
            return "å¤‡ä»½æˆåŠŸ";
        } catch (Exception e) {
            return "å¤‡ä»½å¤±è´¥: " + e.getMessage();
        }
    }, executor);
}
```

### 4. ä¸»é¢˜åˆ‡æ¢ç³»ç»Ÿ

```java
private void showThemeColorDialog() {
    ThemeUtils.Theme[] themes = ThemeUtils.Theme.values();
    String[] themeNames = new String[themes.length];
    for (int i = 0; i < themes.length; i++) {
        themeNames[i] = themes[i].getName();
    }
    
    new AlertDialog.Builder(requireContext())
            .setTitle(R.string.select_theme_color)
            .setItems(themeNames, (dialog, which) -> {
                ThemeUtils.Theme selectedTheme = themes[which];
                ThemeUtils.saveTheme(requireContext(), selectedTheme);
                
                // æ›´æ–°æ˜¾ç¤º
                binding.tvCurrentTheme.setText(selectedTheme.getName());
                binding.viewThemeColor.setBackgroundColor(selectedTheme.getColorInt());
                
                // é€šçŸ¥ä¸»é¢˜å·²æ›´æ”¹
                showThemeChangeNotice();
            })
            .show();
}
```

## æŠ€æœ¯é€‰æ‹© Q&A

### Q1: æ•°æ®åº“ä¸ºä»€ä¹ˆä¸ä½¿ç”¨SQLiteï¼Œè€Œæ˜¯ç”¨Roomï¼ŒäºŒè€…çš„å·®åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ

**A:** æœ¬é¡¹ç›®é€‰æ‹©Roomä½œä¸ºæ•°æ®åº“è§£å†³æ–¹æ¡ˆï¼Œä¸»è¦åŸºäºä»¥ä¸‹è€ƒé‡ï¼š

#### Roomç›¸æ¯”SQLiteçš„ä¼˜åŠ¿ï¼š

**1. ç¼–è¯‘æ—¶éªŒè¯**
- Roomåœ¨ç¼–è¯‘æ—¶ä¼šéªŒè¯SQLæŸ¥è¯¢çš„æ­£ç¡®æ€§ï¼Œè€ŒSQLiteåªèƒ½åœ¨è¿è¡Œæ—¶å‘ç°é”™è¯¯
- é¡¹ç›®ä¸­çš„`NoteDao.java`ä½¿ç”¨`@Query`æ³¨è§£ï¼ŒRoomä¼šæ£€æŸ¥SQLè¯­å¥è¯­æ³•æ­£ç¡®æ€§

**2. ç±»å‹å®‰å…¨**
- Roomæä¾›å¼ºç±»å‹çš„æ•°æ®åº“è®¿é—®ï¼Œé¿å…äº†SQLiteä¸­å®¹æ˜“å‡ºç°çš„ç±»å‹è½¬æ¢é”™è¯¯
- `Note.java`å®ä½“ç±»ä½¿ç”¨`@Entity`æ³¨è§£ï¼ŒRoomè‡ªåŠ¨å¤„ç†Javaå¯¹è±¡å’Œæ•°æ®åº“å­—æ®µçš„æ˜ å°„

**3. å‡å°‘æ ·æ¿ä»£ç **
```java
// Roomåªéœ€è¦å®šä¹‰æ¥å£
@Dao
public interface NoteDao {
    @Insert
    long insert(Note note);
    
    @Query("SELECT * FROM notes WHERE id = :id")
    Note getNoteByIdSync(long id);
}

// ä¼ ç»ŸSQLiteéœ€è¦å¤§é‡æ ·æ¿ä»£ç 
// éœ€è¦æ‰‹åŠ¨å†™SQLiteOpenHelperã€ContentValuesã€Cursorå¤„ç†ç­‰
```

**4. LiveDataæ”¯æŒ**
- RoomåŸç”Ÿæ”¯æŒLiveDataï¼Œå®ç°å“åº”å¼ç¼–ç¨‹
- é¡¹ç›®ä¸­ä½¿ç”¨`LiveData<List<Note>>`ï¼Œæ•°æ®å˜åŒ–æ—¶UIä¼šè‡ªåŠ¨æ›´æ–°

**5. çº¿ç¨‹å®‰å…¨**
- Roomè‡ªåŠ¨å¤„ç†æ•°æ®åº“æ“ä½œçš„çº¿ç¨‹å®‰å…¨é—®é¢˜
- ä¼ ç»ŸSQLiteéœ€è¦æ‰‹åŠ¨ç®¡ç†æ•°æ®åº“è¿æ¥å’Œçº¿ç¨‹

### Q2: å›¾ç‰‡åŠ è½½ä¸ºä»€ä¹ˆç”¨Glideï¼Œé™¤äº†è¿™ä¸ªï¼Œä¼ ç»Ÿå®‰å“å¼€å‘ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆï¼ŒäºŒè€…çš„å·®åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ

**A:** æœ¬é¡¹ç›®é€‰æ‹©Glideè¿›è¡Œå›¾ç‰‡åŠ è½½ï¼Œç›¸æ¯”ä¼ ç»Ÿæ–¹å¼æœ‰æ˜¾è‘—ä¼˜åŠ¿ï¼š

#### ä¼ ç»ŸAndroidå›¾ç‰‡åŠ è½½æ–¹å¼ï¼š
- **BitmapFactory** + **ImageView.setImageBitmap()**
- **AsyncTask** + **HttpURLConnection**
- æ‰‹åŠ¨å®ç°å†…å­˜ç®¡ç†å’Œç¼“å­˜æœºåˆ¶

#### Glideç›¸æ¯”ä¼ ç»Ÿæ–¹å¼çš„ä¼˜åŠ¿ï¼š

**1. è‡ªåŠ¨å†…å­˜ç®¡ç†**
```java
// é¡¹ç›®ä¸­çš„Glideä½¿ç”¨ï¼ˆç®€æ´é«˜æ•ˆï¼‰
Glide.with(this)
    .load(imagePath)
    .centerCrop()
    .into(binding.ivImage);

// ä¼ ç»Ÿæ–¹å¼éœ€è¦æ‰‹åŠ¨ç®¡ç†å†…å­˜
Bitmap bitmap = BitmapFactory.decodeFile(imagePath);
if (bitmap != null) {
    imageView.setImageBitmap(bitmap);
    // éœ€è¦æ‰‹åŠ¨å›æ”¶bitmapé¿å…å†…å­˜æ³„æ¼
    // bitmap.recycle();
}
```

**2. ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥**
- `Glide.with(this)`ä¼šè‡ªåŠ¨ç»‘å®šActivity/Fragmentçš„ç”Ÿå‘½å‘¨æœŸ
- å½“é¡µé¢é”€æ¯æ—¶è‡ªåŠ¨å–æ¶ˆå›¾ç‰‡åŠ è½½ï¼Œé¿å…å†…å­˜æ³„æ¼

**3. å¤šæ ¼å¼æ”¯æŒ**
- æ”¯æŒç½‘ç»œå›¾ç‰‡ã€æœ¬åœ°æ–‡ä»¶ã€èµ„æºæ–‡ä»¶ã€Uriç­‰å¤šç§æ•°æ®æº
- é¡¹ç›®ä¸­æ—¢åŠ è½½æœ¬åœ°å›¾ç‰‡è·¯å¾„ï¼Œä¹Ÿå¤„ç†ç›¸æœºæ‹æ‘„çš„Uri

**4. æ™ºèƒ½ç¼“å­˜æœºåˆ¶**
- è‡ªåŠ¨æä¾›å†…å­˜ç¼“å­˜å’Œç£ç›˜ç¼“å­˜
- ä¼ ç»Ÿæ–¹å¼éœ€è¦æ‰‹åŠ¨å®ç°LruCacheç­‰ç¼“å­˜ç­–ç•¥

**5. å›¾ç‰‡å˜æ¢**
- å†…ç½®centerCropã€åœ†è§’ç­‰å˜æ¢æ•ˆæœ
- ä¼ ç»Ÿæ–¹å¼éœ€è¦æ‰‹åŠ¨ä½¿ç”¨Canvaså’ŒMatrixè¿›è¡Œå˜æ¢

**6. å ä½ç¬¦å’Œé”™è¯¯å¤„ç†**
```java
// Glideå¯ä»¥è½»æ¾è®¾ç½®å ä½å›¾å’Œé”™è¯¯å›¾
Glide.with(context)
    .load(url)
    .placeholder(R.drawable.loading)
    .error(R.drawable.error)
    .into(imageView);
```

#### é¡¹ç›®ä¸­çš„å®é™…åº”ç”¨ï¼š

**ç¬”è®°å›¾ç‰‡æ˜¾ç¤º**ï¼ˆNoteAdapter.javaï¼‰ï¼š
```java
if (note.getImagePath() != null && !note.getImagePath().isEmpty()) {
    binding.ivImage.setVisibility(View.VISIBLE);
    Glide.with(binding.getRoot())
            .load(note.getImagePath())
            .centerCrop()
            .into(binding.ivImage);
} else {
    binding.ivImage.setVisibility(View.GONE);
}
```

**å¤´åƒå¤„ç†**ï¼ˆSettingsFragment.javaï¼‰ï¼š
- æ”¯æŒæ‹ç…§å’Œç›¸å†Œé€‰æ‹©
- è‡ªåŠ¨å‹ç¼©å’ŒBase64è½¬æ¢
- åœ†å½¢å¤´åƒæ˜¾ç¤ºæ•ˆæœ

#### æŠ€æœ¯é€‰æ‹©æ€»ç»“ï¼š

**Roomçš„æ ¸å¿ƒä»·å€¼ï¼š** æä¾›äº†æ›´å®‰å…¨ã€æ›´ç®€æ´çš„æ•°æ®åº“æ“ä½œæ–¹å¼ï¼Œå‡å°‘äº†æ ·æ¿ä»£ç ï¼Œæé«˜äº†å¼€å‘æ•ˆç‡å’Œä»£ç è´¨é‡ã€‚åœ¨MVVMæ¶æ„ä¸­ä¸LiveDataå®Œç¾é…åˆã€‚

**Glideçš„æ ¸å¿ƒä»·å€¼ï¼š** è§£å†³äº†ä¼ ç»Ÿå›¾ç‰‡åŠ è½½çš„å†…å­˜ç®¡ç†éš¾é¢˜ï¼Œæä¾›äº†æ›´é«˜çº§çš„åŠŸèƒ½å’Œæ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚ç‰¹åˆ«é€‚åˆå¤„ç†ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡å†…å®¹ã€‚

è¿™ä¸¤ä¸ªæŠ€æœ¯é€‰æ‹©éƒ½ä½“ç°äº†ç°ä»£Androidå¼€å‘å‘æ›´é«˜æ•ˆã€æ›´å®‰å…¨ã€æ›´æ˜“ç»´æŠ¤æ–¹å‘å‘å±•çš„è¶‹åŠ¿ã€‚

### Q3: ä¸ºä»€ä¹ˆé‡‡ç”¨MVVMæ¶æ„ï¼Œä¸ä¼ ç»ŸMVCæ¶æ„æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**A:** æœ¬é¡¹ç›®é‡‡ç”¨MVVMï¼ˆModel-View-ViewModelï¼‰æ¶æ„æ¨¡å¼ï¼Œè¿™æ˜¯Android Jetpackæ¨èçš„ç°ä»£æ¶æ„æ–¹æ¡ˆï¼š

#### MVVMç›¸æ¯”ä¼ ç»ŸMVC/MVPçš„ä¼˜åŠ¿ï¼š

**1. æ•°æ®ç»‘å®šä¸å“åº”å¼ç¼–ç¨‹**
```java
// é¡¹ç›®ä¸­çš„ViewModelå®ç°
public class NoteViewModel extends AndroidViewModel {
    private final NoteRepository repository;
    private final LiveData<List<Note>> allNotes;
    
    public NoteViewModel(@NonNull Application application) {
        super(application);
        repository = new NoteRepository(application);
        allNotes = repository.getAllNotes();
    }
    
    public LiveData<List<Note>> getAllNotes() {
        return allNotes;
    }
}

// Fragmentä¸­çš„æ•°æ®è§‚å¯Ÿ
noteViewModel.getAllNotes().observe(getViewLifecycleOwner(), notes -> {
    adapter.submitList(notes);
    updateEmptyView(notes == null || notes.isEmpty());
});
```

**2. ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥**
- ViewModelä¼šåœ¨é…ç½®å˜æ›´ï¼ˆå¦‚å±å¹•æ—‹è½¬ï¼‰æ—¶ä¿ç•™æ•°æ®
- LiveDataè‡ªåŠ¨å¤„ç†ç”Ÿå‘½å‘¨æœŸï¼Œé¿å…å†…å­˜æ³„æ¼

**3. èŒè´£æ¸…æ™°åˆ†ç¦»**
- **Modelï¼ˆRepository + Entityï¼‰**ï¼šæ•°æ®è·å–å’Œä¸šåŠ¡é€»è¾‘
- **Viewï¼ˆActivity/Fragmentï¼‰**ï¼šUIæ˜¾ç¤ºå’Œç”¨æˆ·äº¤äº’
- **ViewModel**ï¼šè¿æ¥Viewå’ŒModelï¼Œå¤„ç†UIç›¸å…³çš„æ•°æ®é€»è¾‘

**4. ä¾¿äºå•å…ƒæµ‹è¯•**
- ViewModelç‹¬ç«‹äºAndroidç»„ä»¶ï¼Œå®¹æ˜“è¿›è¡Œå•å…ƒæµ‹è¯•
- ä¼ ç»ŸMVCä¸­ActivityèŒè´£è¿‡é‡ï¼Œéš¾ä»¥æµ‹è¯•

#### ä¼ ç»ŸMVCçš„é—®é¢˜ï¼š
- Activityæ—¢æ˜¯Controlleråˆæ˜¯Viewï¼ŒèŒè´£ä¸æ¸…
- æ•°æ®çŠ¶æ€ç®¡ç†å›°éš¾
- é…ç½®å˜æ›´æ—¶éœ€è¦æ‰‹åŠ¨ä¿å­˜å’Œæ¢å¤æ•°æ®
- ç´§è€¦åˆï¼Œéš¾ä»¥æµ‹è¯•å’Œç»´æŠ¤

### Q4: ä¸ºä»€ä¹ˆé€‰æ‹©Material Design 3ï¼Œä¸ä¼ ç»ŸUIè®¾è®¡æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ

**A:** æœ¬é¡¹ç›®å…¨é¢é‡‡ç”¨Material Design 3è®¾è®¡ç³»ç»Ÿï¼Œè¿™æ˜¯Googleæœ€æ–°çš„è®¾è®¡è¯­è¨€ï¼š

#### Material Design 3çš„ç‰¹è‰²ï¼š

**1. ç°ä»£åŒ–ç»„ä»¶**
```xml
<!-- é¡¹ç›®ä¸­çš„MaterialCardViewä½¿ç”¨ -->
<com.google.android.material.card.MaterialCardView
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    app:cardCornerRadius="16dp"
    app:cardElevation="2dp"
    app:cardBackgroundColor="?attr/colorSurface">
    
<!-- TextInputLayout with Material 3 style -->
<com.google.android.material.textfield.TextInputLayout
    style="@style/Widget.MaterialComponents.TextInputLayout.OutlinedBox"
    android:hint="@string/username"
    app:boxCornerRadiusTopEnd="12dp"
    app:startIconDrawable="@drawable/ic_person">
```

**2. åŠ¨æ€ä¸»é¢˜è‰²ç³»ç»Ÿ**
```java
// é¡¹ç›®ä¸­çš„ä¸»é¢˜åˆ‡æ¢å®ç°
public enum Theme {
    BLUE("æºå¿ƒè“", R.style.Theme_GoodSticks_Blue),
    RED("æ«å¶çº¢", R.style.Theme_GoodSticks_Red),
    PINK("æ´»åŠ›ç²‰", R.style.Theme_GoodSticks_Pink),
    PURPLE("é—ªç”µç´«", R.style.Theme_GoodSticks_Purple),
    YELLOW("ä¾¿å•é»„", R.style.Theme_GoodSticks_Yellow),
    GREEN("å®çŸ³ç»¿", R.style.Theme_GoodSticks_Green),
    CYAN("è‰æœ¨é’", R.style.Theme_GoodSticks_Cyan);
}
```

**3. ä¸€è‡´çš„è®¾è®¡è¯­è¨€**
- åœ†è§’åŠå¾„ï¼š16dpç”¨äºå¡ç‰‡ï¼Œ12dpç”¨äºè¾“å…¥æ¡†
- å¡ç‰‡é˜´å½±ï¼š2dpæä¾›é€‚åº¦çš„å±‚æ¬¡æ„Ÿ
- é¢œè‰²ç³»ç»Ÿï¼šä½¿ç”¨`?attr/colorPrimary`ç­‰åŠ¨æ€é¢œè‰²

#### ç›¸æ¯”ä¼ ç»ŸUIè®¾è®¡çš„ä¼˜åŠ¿ï¼š

**ä¼ ç»ŸAndroid UIçš„é—®é¢˜ï¼š**
- ç»„ä»¶æ ·å¼ä¸ç»Ÿä¸€ï¼Œéœ€è¦å¤§é‡è‡ªå®šä¹‰
- ç¼ºä¹ç»Ÿä¸€çš„è®¾è®¡è§„èŒƒ
- é€‚é…æ·±è‰²æ¨¡å¼å›°éš¾
- ç¼ºä¹ç°ä»£æ„Ÿçš„è§†è§‰æ•ˆæœ

**Material Design 3çš„æ”¹è¿›ï¼š**
- æä¾›å®Œæ•´çš„è®¾è®¡ç³»ç»Ÿå’Œç»„ä»¶åº“
- è‡ªåŠ¨é€‚é…æ·±è‰²æ¨¡å¼
- ç¬¦åˆç°ä»£ç”¨æˆ·æœŸæœ›çš„äº¤äº’ä½“éªŒ
- å‡å°‘UIå¼€å‘å·¥ä½œé‡

### Q5: ä¸ºä»€ä¹ˆä½¿ç”¨EncryptedSharedPreferencesï¼Œä¸æ™®é€šSharedPreferencesæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**A:** æœ¬é¡¹ç›®ä½¿ç”¨EncryptedSharedPreferencesä¿æŠ¤ç”¨æˆ·æ•æ„Ÿæ•°æ®ï¼Œè¿™æ˜¯Android Security Cryptoåº“æä¾›çš„å®‰å…¨å­˜å‚¨æ–¹æ¡ˆï¼š

#### å…·ä½“å®ç°ï¼š

```java
// é¡¹ç›®ä¸­çš„å®‰å…¨å­˜å‚¨åˆå§‹åŒ–
private void initEncryptedSharedPreferences() {
    try {
        MasterKey masterKey = new MasterKey.Builder(this)
                .setKeyScheme(MasterKey.KeyScheme.AES256_GCM)
                .build();
                
        sharedPreferences = EncryptedSharedPreferences.create(
                this,
                "secure_prefs",
                masterKey,
                EncryptedSharedPreferences.PrefKeyEncryptionScheme.AES256_SIV,
                EncryptedSharedPreferences.PrefValueEncryptionScheme.AES256_GCM
        );
    } catch (GeneralSecurityException | IOException e) {
        // é™çº§åˆ°æ™®é€šSharedPreferences
        sharedPreferences = getSharedPreferences("prefs", Context.MODE_PRIVATE);
    }
}
```

#### å®‰å…¨ä¼˜åŠ¿å¯¹æ¯”ï¼š

**æ™®é€šSharedPreferencesï¼š**
- æ•°æ®ä»¥æ˜æ–‡å½¢å¼å­˜å‚¨åœ¨`/data/data/åŒ…å/shared_prefs/`
- Rootè®¾å¤‡æˆ–æ¶æ„åº”ç”¨å¯ç›´æ¥è¯»å–
- å¯†ç ã€Tokenç­‰æ•æ„Ÿä¿¡æ¯æš´éœ²é£é™©é«˜

**EncryptedSharedPreferencesï¼š**
- ä½¿ç”¨AES256-GCMåŠ å¯†ç®—æ³•
- å¯†é’¥å­˜å‚¨åœ¨Android Keystoreä¸­ï¼Œç¡¬ä»¶çº§åˆ«ä¿æŠ¤
- å³ä½¿è·å–æ–‡ä»¶å†…å®¹ä¹Ÿæ— æ³•è§£å¯†
- è‡ªåŠ¨å¤„ç†å¯†é’¥ç”Ÿæˆå’Œç®¡ç†

#### é¡¹ç›®ä¸­çš„åº”ç”¨åœºæ™¯ï¼š
```java
// å­˜å‚¨ç”¨æˆ·ç™»å½•ä¿¡æ¯
editor.putBoolean("is_logged_in", true);
editor.putString("username", username);
editor.putLong("user_id", user.getId());
editor.putString("password", password); // åŠ å¯†å­˜å‚¨å¯†ç 

// å­˜å‚¨WebDAVé…ç½®ä¿¡æ¯
editor.putString("webdav_url", url);
editor.putString("webdav_username", username);
editor.putString("webdav_password", password);

// å­˜å‚¨ç”¨æˆ·å¤´åƒæ•°æ®
String avatarKey = "avatar_" + currentUserId;
prefs.edit().putString(avatarKey, base64).apply();
```

### Q6: ä¸ºä»€ä¹ˆä½¿ç”¨LottieåŠ¨ç”»ï¼Œä¸ä¼ ç»ŸåŠ¨ç”»æ–¹æ¡ˆæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**A:** è™½ç„¶é¡¹ç›®ä¸­ä¸»è¦ä½¿ç”¨äº†å±æ€§åŠ¨ç”»ï¼Œä½†é›†æˆäº†Lottieåº“ä¸ºæœªæ¥çš„å¤æ‚åŠ¨ç”»åšå‡†å¤‡ï¼š

#### å½“å‰åŠ¨ç”»å®ç°ï¼š

```java
// é¡¹ç›®ä¸­çš„å¯åŠ¨é¡µåŠ¨ç”»ï¼ˆå±æ€§åŠ¨ç”»ï¼‰
private void startAnimation() {
    // Logo æ¸å…¥åŠ¨ç”»
    binding.ivLogo.setAlpha(0f);
    binding.ivLogo.animate()
            .alpha(1f)
            .setDuration(1000)
            .setListener(null);
            
    // App åç§°æ¸å…¥åŠ¨ç”»
    binding.tvAppName.setAlpha(0f);
    binding.tvAppName.animate()
            .alpha(1f)
            .setStartDelay(500)
            .setDuration(1000)
            .setListener(null);
}

// Fragmentåˆ‡æ¢åŠ¨ç”»
getSupportFragmentManager().beginTransaction()
        .setCustomAnimations(
                R.anim.fade_in,    // æ·¡å…¥åŠ¨ç”»
                R.anim.fade_out    // æ·¡å‡ºåŠ¨ç”»
        )
        .hide(activeFragment)
        .show(targetFragment)
        .commitNow();
```

#### Lottieç›¸æ¯”ä¼ ç»ŸåŠ¨ç”»çš„ä¼˜åŠ¿ï¼š

**ä¼ ç»ŸAndroidåŠ¨ç”»çš„å±€é™ï¼š**
- **å¸§åŠ¨ç”»**ï¼šå ç”¨å†…å­˜å¤§ï¼Œæ–‡ä»¶ä½“ç§¯å¤§
- **è¡¥é—´åŠ¨ç”»**ï¼šåªèƒ½å®ç°ç®€å•çš„å˜æ¢æ•ˆæœ
- **å±æ€§åŠ¨ç”»**ï¼šå¤æ‚åŠ¨ç”»éœ€è¦å¤§é‡ä»£ç 
- **VectoråŠ¨ç”»**ï¼šåˆ›å»ºå’Œè°ƒè¯•å›°éš¾

**Lottieçš„ä¼˜åŠ¿ï¼š**
1. **è®¾è®¡å¸ˆå‹å¥½**ï¼šæ”¯æŒAfter Effectså¯¼å‡ºï¼Œè®¾è®¡å¸ˆå¯ç›´æ¥åˆ›å»º
2. **æ–‡ä»¶å°å·§**ï¼šJSONæ ¼å¼ï¼Œæ¯”GIF/è§†é¢‘å°å¾ˆå¤š
3. **æ— æŸç¼©æ”¾**ï¼šåŸºäºçŸ¢é‡ï¼Œé€‚é…æ‰€æœ‰å±å¹•å¯†åº¦
4. **äº¤äº’æ€§å¼º**ï¼šæ”¯æŒåŠ¨æ€æ”¹å˜é¢œè‰²ã€æ’­æ”¾æ§åˆ¶ç­‰
5. **è·¨å¹³å°**ï¼šåŒä¸€ä¸ªæ–‡ä»¶å¯åœ¨Androidã€iOSã€Webä½¿ç”¨

#### ä½¿ç”¨åœºæ™¯è§„åˆ’ï¼š
- å¯åŠ¨é¡µå“ç‰ŒåŠ¨ç”»
- åŠ è½½çŠ¶æ€æŒ‡ç¤ºå™¨
- ç”¨æˆ·æ“ä½œåé¦ˆåŠ¨ç”»
- ç©ºçŠ¶æ€é¡µé¢æ’å›¾

### Q7: ä¸ºä»€ä¹ˆé€‰æ‹©WebDAVè¿›è¡Œæ•°æ®åŒæ­¥ï¼Œä¸å…¶ä»–åŒæ­¥æ–¹æ¡ˆçš„å¯¹æ¯”ï¼Ÿ

**A:** é¡¹ç›®é€‰æ‹©WebDAVåè®®å®ç°äº‘ç«¯æ•°æ®å¤‡ä»½ï¼Œè¿™æ˜¯ä¸€ä¸ªå¼€æ”¾æ ‡å‡†çš„æ–‡ä»¶ä¼ è¾“åè®®ï¼š

#### WebDAVå®ç°ï¼š

```java
// é¡¹ç›®ä¸­çš„WebDAVå¤‡ä»½å®ç°
public static CompletableFuture<String> createBackup(Context context, long userId) {
    return CompletableFuture.supplyAsync(() -> {
        try {
            // åˆ›å»ºå¤‡ä»½æ•°æ®
            BackupData backupData = createBackupData(context, userId);
            String jsonData = gson.toJson(backupData);
            
            // åˆå§‹åŒ–WebDAVå®¢æˆ·ç«¯
            Sardine sardine = getSardine(context);
            String fileName = "goodsticks_backup_" + 
                new SimpleDateFormat("yyyy-MM-dd_HH-mm-ss", Locale.getDefault())
                    .format(new Date()) + ".json";
            
            // ä¸Šä¼ å¤‡ä»½æ–‡ä»¶
            sardine.put(webdavUrl + "/" + fileName, 
                       jsonData.getBytes(StandardCharsets.UTF_8));
            
            return "å¤‡ä»½æˆåŠŸ";
        } catch (Exception e) {
            return "å¤‡ä»½å¤±è´¥: " + e.getMessage();
        }
    }, executor);
}
```

#### ä¸å…¶ä»–åŒæ­¥æ–¹æ¡ˆçš„å¯¹æ¯”ï¼š

**1. äº‘æœåŠ¡APIï¼ˆå¦‚Google Driveã€iCloudï¼‰**
- **ä¼˜åŠ¿**ï¼šå®˜æ–¹æ”¯æŒï¼Œç¨³å®šæ€§å¥½
- **åŠ£åŠ¿**ï¼šä¾èµ–ç‰¹å®šå¹³å°ï¼Œç”¨æˆ·éœ€è¦å¯¹åº”è´¦å·
- **é¡¹ç›®é€‰æ‹©**ï¼šWebDAVæ›´çµæ´»ï¼Œç”¨æˆ·å¯é€‰æ‹©ä»»æ„æ”¯æŒçš„äº‘å­˜å‚¨

**2. è‡ªå»ºæœåŠ¡å™¨**
- **ä¼˜åŠ¿**ï¼šå®Œå…¨æ§åˆ¶ï¼ŒåŠŸèƒ½å®šåˆ¶åŒ–
- **åŠ£åŠ¿**ï¼šå¼€å‘ç»´æŠ¤æˆæœ¬é«˜ï¼Œéœ€è¦æœåŠ¡å™¨èµ„æº
- **é¡¹ç›®é€‰æ‹©**ï¼šWebDAVåˆ©ç”¨ç°æœ‰äº‘å­˜å‚¨ï¼Œæ— éœ€é¢å¤–æœåŠ¡å™¨

**3. Firebase/äº‘æ•°æ®åº“**
- **ä¼˜åŠ¿**ï¼šå®æ—¶åŒæ­¥ï¼Œå¤šè®¾å¤‡åä½œ
- **åŠ£åŠ¿**ï¼šä¾èµ–ç½‘ç»œï¼Œæœ‰ä½¿ç”¨é™åˆ¶å’Œè´¹ç”¨
- **é¡¹ç›®é€‰æ‹©**ï¼šä¸ªäººç¬”è®°åº”ç”¨ï¼ŒWebDAVçš„ç®€å•å¤‡ä»½æ¢å¤å·²è¶³å¤Ÿ

#### WebDAVçš„å®é™…ä¼˜åŠ¿ï¼š

**1. å¹¿æ³›å…¼å®¹æ€§**
- æ”¯æŒNextcloudã€ownCloudç­‰ç§æœ‰äº‘
- æ”¯æŒé˜¿é‡Œäº‘ç›˜ã€123ç½‘ç›˜ç­‰å•†ä¸šæœåŠ¡
- æ”¯æŒAListç­‰æœ¬åœ°æ–‡ä»¶ç®¡ç†å·¥å…·

**2. ç”¨æˆ·æ§åˆ¶æƒ**
```java
// ç”¨æˆ·å¯è‡ªç”±é…ç½®WebDAVæœåŠ¡å™¨
SharedPreferences prefs = GoodSticksApplication.getInstance().getSecureSharedPreferences();
String webdavUrl = prefs.getString("webdav_url", "");
String webdavUsername = prefs.getString("webdav_username", "");
String webdavPassword = prefs.getString("webdav_password", "");
```

**3. æ•°æ®å®‰å…¨æ€§**
- æ•°æ®å­˜å‚¨åœ¨ç”¨æˆ·é€‰æ‹©çš„æœåŠ¡å™¨
- æ”¯æŒHTTPSåŠ å¯†ä¼ è¾“
- æœ¬åœ°æ•°æ®åŠ å¯†å­˜å‚¨

#### æŠ€æœ¯é€‰æ‹©æ€»ç»“ï¼š

æœ¬é¡¹ç›®çš„æ¯ä¸ªæŠ€æœ¯é€‰æ‹©éƒ½åŸºäºç°ä»£Androidå¼€å‘çš„æœ€ä½³å®è·µï¼š

- **Room + MVVM**ï¼šæ„å»ºæ¸…æ™°çš„æ¶æ„å±‚æ¬¡ï¼Œä¾¿äºç»´æŠ¤å’Œæµ‹è¯•
- **Glide + Material Design 3**ï¼šæä¾›ç°ä»£åŒ–çš„ç”¨æˆ·ä½“éªŒ
- **EncryptedSharedPreferences**ï¼šä¿æŠ¤ç”¨æˆ·éšç§å’Œæ•°æ®å®‰å…¨
- **Lottie + WebDAV**ï¼šä¸ºæœªæ¥åŠŸèƒ½æ‰©å±•æä¾›æŠ€æœ¯åŸºç¡€

è¿™äº›æŠ€æœ¯é€‰æ‹©ä¸ä»…è§£å†³äº†å½“å‰éœ€æ±‚ï¼Œä¹Ÿä¸ºåº”ç”¨çš„é•¿æœŸå‘å±•å¥ å®šäº†åšå®åŸºç¡€ã€‚

## æ³¨æ„äº‹é¡¹

- åº”ç”¨ä½¿ç”¨åŠ å¯†å­˜å‚¨ä¿æŠ¤ç”¨æˆ·å¯†ç 
- æ‹ç…§åŠŸèƒ½éœ€è¦ç›¸æœºæƒé™
- é€‰æ‹©å›¾ç‰‡éœ€è¦å­˜å‚¨æƒé™
- å›¾ç‰‡å­˜å‚¨åœ¨åº”ç”¨ç§æœ‰ç›®å½•ï¼Œå¸è½½åº”ç”¨ä¼šåˆ é™¤æ‰€æœ‰æ•°æ®
- å¤‡ä»½æ¢å¤åŠŸèƒ½éœ€è¦è”ç½‘æƒé™

## å¼€å‘è€…

[YoungLee](https://younglee.cn/)